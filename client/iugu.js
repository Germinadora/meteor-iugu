Iugu=function(){function s(e,t){var n,r,i;r=e.getElementsByTagName("input"),i=e.getElementsByTagName("select"),n={};for(var s=0;s<r.length;s++){attr=r[s].getAttribute("data-iugu");if(attr==null)continue;if(t.indexOf(attr)==-1)continue;n[attr]=r[s].value}for(var s=0;s<i.length;s++){attr=i[s].getAttribute("data-iugu");if(attr==null)continue;if(t.indexOf(attr)==-1)continue;i[s].selectedIndex!=null&&(n[attr]=i[s].options[i[s].selectedIndex].value)}return n}function o(e,t,n){t==null&&(t=[]);for(index in e)param=e[index],n&&(index=n+"["+index+"]"),typeof param=="object"?o(param,t,index):t.push(index+"="+encodeURIComponent(param));return t.join("&").replace(/%20/g,"+")}function u(){return e+"/"+t+"/"}function a(e,t){var r=t.callbackName||"callback",i=t.onSuccess||function(){},s=t.onTimeout||function(){},u=t.timeout||5,a=t.data||{};a.account_id=n,a.callback=r;var f=document.createElement("script"),l=window.setTimeout(function(){window[r]=function(){},s(),document.getElementsByTagName("head")[0].removeChild(f)},u*1e3);window[r]=function(e){window.clearTimeout(l),i(e),document.getElementsByTagName("head")[0].removeChild(f)},f.type="text/javascript",f.async=!0,f.src=e+"?"+o(a),document.getElementsByTagName("head")[0].appendChild(f)}var e="https://api.iugu.com",t="v1",n=null,r=!1,i=["number","verification_value","first_name","last_name","expiration","expiration_month","expiration_year"];return cards={visa:{cvv_pattern:/^[0-9]{3}$/,brand:[40,41,42,43,44,45,46,47,48,49]},mastercard:{cvv_pattern:/^[0-9]{3}$/,brand:[50,51,52,53,54,55,56,57,58,59]},amex:{cvv_pattern:/^[0-9]{4}$/,brand:[34,37]},diners:{cvv_pattern:/^[0-9]{3}$/,brand:[30,36,38,39]},elo:{cvv_pattern:/^[0-9]{3}$/,brand:[63]}},utils={validateAccountID:function(e){if(!/^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/.test(e))return"ID de Conta (AccountID) inválido.\r\nConfigure usando o método setAccountID()"},formatUUID:function(e){var t=e.toUpperCase().replace("-","");return t.substr(0,8)+"-"+t.substr(8,4)+"-"+t.substr(12,4)+"-"+t.substr(16,4)+"-"+t.substr(20,12)},validateCreditCardNumber:function(e){if(e.length==0||/[^0-9-\s]+/.test(e))return!1;var t=0,n=0,r=!1;e=e.replace(/\D/g,"");for(var i=e.length-1;i>=0;i--){var s=e.charAt(i),n=parseInt(s,10);r&&(n*=2)>9&&(n-=9),t+=n,r=!r}return t%10==0},validateCVV:function(e,t){return t?cards[t]?cards[t].cvv_pattern.test(e):!1:!1},validateExpiration:function(e,t){today=new Date;if(e==undefined)return!1;if(t==undefined)return!1;t.length==2&&(t=today.getFullYear().toString().substr(0,2)+t);if(t<today.getFullYear())return!1;if(t==today.getFullYear())if(e>12||e<today.getMonth()+1)return!1;return!0},validateExpirationString:function(e){return e=this.getMonthYearByFullExpiration(e),!e||e.length!=2?!1:this.validateExpiration(e[0],e[1])},validateFirstName:function(e){return!e||e.length==0?!1:!0},validateLastName:function(e){return!e||e.length==0?!1:!0},getMonthYearByFullExpiration:function(e){return e=e.toString().split("/"),!e||e.length!=2?!1:[e[0],e[1]]},getBrandByCreditCardNumber:function(e){first_two=parseInt(e.slice(0,2));for(var t in cards)if(cards.hasOwnProperty(t)){var n=cards[t];if(cards[t].brand.indexOf(first_two)!=-1)return utils.keyOf(cards,cards[t])}return!1},trim:function(e){return e.replace(/^\s+/g,"").replace(/\s+$/,"")},keyOf:function(e,t){for(var n in e)if(hasOwnProperty.call(e,n)&&e[n]===t)return n;return null}},{utils:utils,CreditCard:function(e,t,n,r,i,s){e=e,e=e.replace(/ +/g,""),e=e.replace(/-+/g,""),t=t,n=n;var o=new Date;return n!=undefined&&n.length==2&&(n=o.getFullYear().toString().substr(0,2)+n),r=r,i=i,s=s,{errors:function(){return _errors={},utils.validateCreditCardNumber(e)||(_errors.number="is_invalid"),utils.validateCVV(s,utils.getBrandByCreditCardNumber(e))||(_errors.verification_value="is_invalid"),utils.validateExpiration(t,n)||(_errors.expiration="is_invalid"),utils.validateFirstName(r)||(_errors.first_name="is_invalid"),utils.validateLastName(i)||(_errors.last_name="is_invalid"),_errors},valid:function(){return Object.keys(this.errors()).length>0?!1:!0},brand:function(){return utils.getBrandByCreditCardNumber(e)},toData:function(){return{number:e,verification_value:s,first_name:r,last_name:i,month:t,year:n,brand:this.brand()}}}},createPaymentToken:function(e,t){err=utils.validateAccountID(n);if(err){alert(err);return}cc=!1,e.toData!==undefined?cc=e:e.number!==undefined?cc=this.CreditCard(e.number,e.month,e.year,e.first_name,e.last_name,e.verification_value):e.tagName.toUpperCase()=="FORM"&&(formData=s(e,i),expiration=this.utils.getMonthYearByFullExpiration(formData.expiration),cc=this.CreditCard(formData.number,expiration[0],expiration[1],formData.first_name,formData.last_name,formData.verification_value));var o=t||function(){};if(!cc.valid())return o({errors:cc.errors()});data={method:"credit_card",data:cc.toData()},r==1&&(data.test=1),a(u()+"payment_token",{data:data,onSuccess:function(e){e.errors==undefined&&e.id.length==32&&(e.id=utils.formatUUID(e.id)),o(e)},onTimeout:function(){o({errors:{timeout:"operation_timeout"}})}})},setAccountID:function(e){n=e},setTestMode:function(e){r=e}}}();